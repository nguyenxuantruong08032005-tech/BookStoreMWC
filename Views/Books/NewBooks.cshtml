@model BookStoreMVC.Models.ViewModels.NewBooksPageViewModel
@using System.Collections.Generic

@{
    var pageTitle = ViewBag.PageTitle as string ?? "Sách mới phát hành";
    var pageDescription = ViewBag.PageDescription as string ?? "Khám phá những đầu sách vừa cập bến cửa hàng trong thời gian gần đây.";
    ViewData["Title"] = pageTitle;
}

@section Styles {
    <style>
        .nb-hero {
            background: linear-gradient(135deg, #5b21b6 0%, #1d4ed8 100%);
        }

        .nb-spotlight-card {
            backdrop-filter: blur(6px);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
        }

        .nb-category-chip {
            transition: all 0.2s ease;
        }

        .nb-category-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
        }

        .nb-filter-tab {
            transition: all 0.2s ease;
        }

        .nb-filter-tab:hover {
            transform: translateY(-1px);
        }
    </style>
}

<section class="nb-hero text-white rounded-3xl shadow-xl overflow-hidden mb-10">
    <div class="px-6 sm:px-10 md:px-16 lg:px-20 py-12">
        <div class="max-w-4xl">
            <p class="uppercase tracking-[0.4em] text-white/70 text-xs font-semibold mb-4">New Arrivals</p>
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold leading-tight mb-5">
                @pageTitle
            </h1>
            <p class="text-base sm:text-lg md:text-xl text-white/85 max-w-2xl">
                @pageDescription
            </p>
        </div>

        <div class="mt-10 grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div class="bg-white/15 rounded-2xl p-5 flex items-center gap-4">
                <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-white/20">
                    <i class="fas fa-book text-2xl"></i>
                </div>
                <div>
                    <p class="text-sm uppercase tracking-wide text-white/70">Tổng sách mới</p>
                    <p class="text-2xl sm:text-3xl font-bold">@Model.TotalNewBooks.ToString("N0")</p>
                </div>
            </div>
            <div class="bg-white/15 rounded-2xl p-5 flex items-center gap-4">
                <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-white/20">
                    <i class="fas fa-calendar-plus text-2xl"></i>
                </div>
                <div>
                    <p class="text-sm uppercase tracking-wide text-white/70">Thêm trong 30 ngày</p>
                    <p class="text-2xl sm:text-3xl font-bold">@Model.BooksAddedThisMonth.ToString("N0")</p>
                </div>
            </div>
            <div class="bg-white/15 rounded-2xl p-5 flex items-center gap-4">
                <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-white/20">
                    <i class="fas fa-layer-group text-2xl"></i>
                </div>
                <div>
                    <p class="text-sm uppercase tracking-wide text-white/70">Danh mục tham gia</p>
                    <p class="text-2xl sm:text-3xl font-bold">@Model.ActiveCategories.ToString("N0")</p>
                </div>
            </div>
        </div>

        @if (Model.LatestAddedDate.HasValue)
        {
            <p class="mt-6 text-sm text-white/70 flex items-center gap-2">
                <i class="fas fa-clock"></i>
                Cập nhật gần nhất: @Model.LatestAddedDate.Value.ToString("dd/MM/yyyy HH:mm")
            </p>
        }

        @if (Model.HighlightCategories.Any())
        {
            <div class="mt-8 flex flex-wrap gap-3">
                @foreach (var category in Model.HighlightCategories)
                {
                    <a asp-controller="Books" asp-action="Category" asp-route-id="@category.Id" asp-route-name="@category.Name"
                       class="nb-category-chip inline-flex items-center gap-2 bg-white text-indigo-700 px-4 py-2 rounded-full text-sm font-semibold">
                        <i class="fas fa-hashtag text-indigo-500"></i>
                        <span>@category.Name</span>
                        <span class="text-xs text-indigo-400">@category.BookCount.ToString("N0")</span>
                    </a>
                }
            </div>
        }
    </div>
</section>

<div class="space-y-16">
    @if (Model.SpotlightBooks.Any())
    {
        <section class="space-y-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-900">Góc spotlight</h2>
                    <p class="text-gray-500">Những cuốn sách mới nổi bật được độc giả quan tâm nhất</p>
                </div>
                <a asp-action="Index" asp-route-sortBy="newest" class="inline-flex items-center text-indigo-600 hover:text-indigo-800 font-semibold">
                    Xem tất cả sách mới
                    <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>

            <div class="grid gap-6 md:grid-cols-3">
                @foreach (var book in Model.SpotlightBooks)
                {
                    <a asp-action="Details" asp-route-id="@book.Id"
                       class="nb-spotlight-card rounded-2xl shadow-lg p-5 flex flex-col gap-4 border border-white/40 hover:border-indigo-200 transition-all">
                        <div class="flex items-start gap-4">
                            <div class="w-24 h-32 rounded-xl overflow-hidden shadow-inner">
                                <img src="@(!string.IsNullOrEmpty(book.ImageUrl) ? book.ImageUrl : book.DefaultImageUrl)"
                                     alt="@book.ImageAlt" class="w-full h-full object-cover" />
                            </div>
                            <div class="flex-1">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-indigo-100 text-indigo-700 mb-2">
                                    Mới ngày @book.CreatedDate.ToString("dd/MM")
                                </span>
                                <h3 class="text-lg font-semibold text-gray-900 leading-snug line-clamp-2">@book.Title</h3>
                                <p class="text-sm text-gray-600 mt-1 flex items-center gap-2">
                                    <i class="fas fa-pen-nib text-indigo-400"></i>
                                    <span>@book.Author</span>
                                </p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm text-gray-600">
                            <span>
                                <i class="fas fa-star text-yellow-400 mr-1"></i>
                                @(book.AverageRating > 0 ? book.AverageRating.ToString("0.0") : "Chưa có đánh giá")
                            </span>
                            <span class="font-semibold text-indigo-600">@book.DisplayPrice.ToString("N0") ₫</span>
                        </div>
                    </a>
                }
            </div>
        </section>
    }

    @if (Model.TrendingBooks.Any())
    {
        <section class="space-y-6">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-gray-900">Đang được yêu thích</h2>
                <span class="text-sm text-gray-500">Dựa trên lượt đánh giá và xếp hạng của độc giả</span>
            </div>
            <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6">
                @foreach (var book in Model.TrendingBooks)
                {
                    @await Html.PartialAsync("_BookCard", book)
                }
            </div>
        </section>
    }

    <section class="space-y-8">
        <div class="bg-white rounded-3xl shadow-lg border border-gray-100 p-6">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Tất cả sách mới</h2>
                    <p class="text-gray-500">Tìm kiếm theo từ khóa hoặc lọc theo nhu cầu của bạn</p>
                </div>
                <form asp-action="NewBooks" method="get" class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto">
                    <input type="hidden" name="filter" value="@Model.ActiveFilter" />
                    <div class="flex-1 relative">
                        <input type="text" name="searchTerm" value="@Model.Listing.SearchTerm"
                               class="w-full border border-gray-200 rounded-2xl py-3 pl-11 pr-4 focus:ring-2 focus:ring-indigo-400 focus:border-transparent text-sm"
                               placeholder="Tìm sách theo tên, tác giả, nhà xuất bản..." />
                        <span class="absolute inset-y-0 left-4 flex items-center text-gray-400">
                            <i class="fas fa-search"></i>
                        </span>
                    </div>
                    <button type="submit" class="inline-flex items-center justify-center px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-2xl shadow">
                        Tìm kiếm
                    </button>
                </form>
            </div>

            <div class="mt-6 flex flex-wrap items-center gap-3">
                @{ var filters = new Dictionary<string, string>
                    {
                        ["all"] = "Tất cả",
                        ["hot"] = "Được yêu thích",
                        ["discount"] = "Đang giảm giá",
                        ["price"] = "Giá tốt"
                    };
                }
                @foreach (var filter in filters)
                {
                    var isActive = string.Equals(Model.ActiveFilter, filter.Key, StringComparison.OrdinalIgnoreCase);
                    <a asp-action="NewBooks" asp-route-filter="@filter.Key" asp-route-searchTerm="@Model.Listing.SearchTerm"
                       class="nb-filter-tab inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium @(isActive ? "bg-indigo-600 text-white shadow-lg" : "bg-gray-100 text-gray-600 hover:bg-gray-200")">
                        @if (filter.Key == "hot")
                        {
                            <i class="fas fa-fire text-orange-500"></i>
                        }
                        else if (filter.Key == "discount")
                        {
                            <i class="fas fa-tags text-red-500"></i>
                        }
                        else if (filter.Key == "price")
                        {
                            <i class="fas fa-coins text-amber-500"></i>
                        }
                        else
                        {
                            <i class="fas fa-globe-asia text-indigo-400"></i>
                        }
                        <span>@filter.Value</span>
                    </a>
                }
            </div>
        </div>

        @if (Model.Listing.Books.Any())
        {
            <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
                @foreach (var book in Model.Listing.Books)
                {
                    @await Html.PartialAsync("_BookCard", book)
                }
            </div>

            @if (Model.Listing.TotalPages > 1)
            {
                <nav class="flex justify-center mt-10" aria-label="Pagination">
                    <ul class="inline-flex items-center space-x-2">
                        <li>
                            @if (Model.Listing.HasPreviousPage)
                            {
                                <a asp-action="NewBooks" asp-route-page="@(Model.Listing.PageNumber - 1)"
                                   asp-route-filter="@Model.ActiveFilter"
                                   asp-route-searchTerm="@Model.Listing.SearchTerm"
                                   class="px-3 py-2 rounded-xl border border-gray-200 text-sm text-gray-600 hover:bg-gray-100">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            }
                            else
                            {
                                <span class="px-3 py-2 rounded-xl border border-gray-200 text-sm text-gray-400 bg-gray-100">
                                    <i class="fas fa-chevron-left"></i>
                                </span>
                            }
                        </li>

                        @for (var i = 1; i <= Model.Listing.TotalPages; i++)
                        {
                            <li>
                                <a asp-action="NewBooks" asp-route-page="@i"
                                   asp-route-filter="@Model.ActiveFilter"
                                   asp-route-searchTerm="@Model.Listing.SearchTerm"
                                   class="px-3 py-2 rounded-xl text-sm font-medium @(i == Model.Listing.PageNumber ? "bg-indigo-600 text-white" : "text-gray-600 hover:bg-gray-100 border border-gray-200")">
                                    @i
                                </a>
                            </li>
                        }

                        <li>
                            @if (Model.Listing.HasNextPage)
                            {
                                <a asp-action="NewBooks" asp-route-page="@(Model.Listing.PageNumber + 1)"
                                   asp-route-filter="@Model.ActiveFilter"
                                   asp-route-searchTerm="@Model.Listing.SearchTerm"
                                   class="px-3 py-2 rounded-xl border border-gray-200 text-sm text-gray-600 hover:bg-gray-100">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            }
                            else
                            {
                                <span class="px-3 py-2 rounded-xl border border-gray-200 text-sm text-gray-400 bg-gray-100">
                                    <i class="fas fa-chevron-right"></i>
                                </span>
                            }
                        </li>
                    </ul>
                </nav>
            }
        }
        else
        {
            <div class="text-center bg-white border border-dashed border-indigo-200 rounded-3xl py-16 px-6">
                <div class="mx-auto w-24 h-24 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-500 mb-6">
                    <i class="fas fa-book-open text-3xl"></i>
                </div>
                <h3 class="text-2xl font-semibold text-gray-800 mb-3">Chưa có sách mới phù hợp</h3>
                <p class="text-gray-500 max-w-xl mx-auto mb-6">
                    Thử điều chỉnh từ khóa tìm kiếm hoặc quay lại vào thời gian khác khi có thêm sách mới.
                </p>
                <div class="flex flex-wrap justify-center gap-4">
                    <a asp-action="NewBooks" class="inline-flex items-center bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-semibold shadow">
                        Làm mới bộ lọc
                    </a>
                    <a asp-controller="Home" asp-action="Index" class="inline-flex items-center bg-white border border-indigo-200 text-indigo-600 px-6 py-3 rounded-xl font-semibold hover:bg-indigo-50">
                        Về trang chủ
                    </a>
                </div>
            </div>
        }
    </section>
</div>